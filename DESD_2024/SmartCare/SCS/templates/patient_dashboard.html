{% extends 'index.html' %}
{% block content%}
{% include 'CheckSession.html' %}
{% load static %}

<script src="{% static 'js/patient_dashboard.js' %}"></script>

<div class="container">
  <div class="row">
    <div class="col-md-6">
      <h2>Book Appointment</h2>
      <p>Book an appointment with a doctor or nurse</p>
      <form id ="patient-booking-form" method="post">
        {% csrf_token %}
        <label for="service">Service: </label>
        <select id="service" name="service" required>
        <option selected disabled hidden>Select a service</option>
          {% for service_id, service_name, service_duration in services %} 
            <option value="{{service_id}}">{{ service_name }}</li> 
          {% endfor %} 
        </select>
        <br>
    
        <label for="bookingDate" id="bookingDateLabel">Date: </label>
        <input id="bookingDate" type="date" name="bookingDate" disabled>
        <br>
        <label for="practitioner" id="practitionerLabel"  >Doctor/Nurse: </label>
        <select id="practitioner" name="practitioner"  required disabled>
          <option selected disabled hidden>Select a Practitioner</option>
        </select>
        <br>
        <label for="timeSlot"  id="timeSlotLabel">Time Slot: </label>
        <select id="timeSlot" name="timeSlot" required disabled>
          <option selected disabled hidden>Select a Time Slot</option>
        </select>
        <br>
        <textarea name="reason" id="reason" placeholder="Reason for appointment"></textarea>
        <br>
        <button>Book Appointment</button>
    </form>
    </div>
  </div>


<script>

document.addEventListener('DOMContentLoaded', function() {
    setDatePickerMinDateNow("bookingDate");

});

// Adding event listener that listens for changes in the service select element
document.getElementById("service").addEventListener("change", function (e) {
  e.preventDefault();
  bookingDate = document.getElementById("bookingDate");
  practitionerSelect = document.getElementById("practitioner");
  timeSlotSelect = document.getElementById("timeSlot");
  if (e.target.value == "") {
    var bookingDate = document.getElementById('bookingDate');
    var bookingDateLabel = document.getElementById('bookingDateLabel');
    bookingDate.disabled = true;
    bookingDate.innerHTML = createSelectPlaceholderElement("Select a Date");
    practitionerSelect.disabled = true;
    practitionerSelect.innerHTML = createSelectPlaceholderElement("Select a Practitioner");
    timeSlotSelect.disabled = true;
    timeSlotSelect.innerHTML = "";
    timeSlotSelect.add(createSelectPlaceholderElement("Select a Time Slot"));
    document.getElementById('practitionerLabel').hidden = true;
    
    return;
  }
  else if (bookingDate.value !== "" && bookingDate.disabled === false) {
    getPractitionersByDayAndService(e.target, bookingDate)
    timeSlotSelect.disabled = true;
    populateTimeSlots([]);
  }
  else{
  var bookingDate = document.getElementById('bookingDate');
  var bookingDateLabel = document.getElementById('bookingDateLabel');

  bookingDate.disabled = false;
  }
 });

// Adding event listener that listens for changes in the bookingDate input element
document.getElementById("bookingDate").addEventListener("change", function (e) {
  e.preventDefault();
  if (e.target.value === "") {
    var practitionerSelect = document.getElementById('practitioner');
    practitionerSelect.disabled = true;
    practitionerSelect.innerHTML = createSelectPlaceholderElement("Select a Date");
    document.getElementById('practitionerLabel').hidden = true;
    var timeSlotSelect = document.getElementById('timeSlot');
    timeSlotSelect.disabled = true;
    timeSlotSelect.innerHTML = "";
    timeSlotSelect.add(createSelectPlaceholderElement("Select a Time Slot"));
  }
  else{
    var timeSlotSelect = document.getElementById('timeSlot');
    timeSlotSelect.disabled = true;
    timeSlotSelect.innerHTML = "";
    timeSlotSelect.add(createSelectPlaceholderElement("Select a Time Slot"));
    var service = document.getElementById('service');
    getPractitionersByDayAndService(service, e.target);
  }
  return;

});

// Adding event listener that listens for changes in the practitioner input element
document.getElementById("practitioner").addEventListener("change", function (e) {
  e.preventDefault();
  if (e.target.value !== "") {
    var bookingDate = document.getElementById('bookingDate');
    getTimeSlotsByDayAndPractitioner(bookingDate, e.target);
  }
  
});


// Adding event listener that submits the form when the submit button is clicked
document.getElementById("patient-booking-form").addEventListener("submit", function (e) {
   e.preventDefault();
   makePatientAppointmentBooking(this);
});

</script>

{% endblock %}