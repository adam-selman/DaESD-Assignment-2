{% extends 'index.html' %}
{% block content%}
<p>patient page</p>

<form id ="patient-booking-form" method="post">
    {% csrf_token %}
    {{ form }}
    <button>Book Appointment</button>
</form>

<script>

document.getElementById("patient-booking-form").addEventListener("submit", function (e) {
   e.preventDefault();
   makePatientAppointmentBooking(e.target);
   var formData = new FormData(document.getElementById('patient-booking-form'));
   var token = "{{ csrf_token }}" ;
 });

 function makePatientAppointmentBooking(form) {
    var formData = new FormData(form);
    var token = "{{ csrf_token }}" ;

    if (formData.get('bookingDate') === "") {
      alert("Please select a date");
      return;
    }

    else if (formData.get('practitioner') === "") {
      alert("Please select a practitioner");
      return;
    }

    fetch('patient_appointment_booking', {
    method: 'POST',
    headers: {
            'X-CSRFToken': token
            },
  
  body: formData
})
.then(response => response.json())
.then(data => {
  if (data.success) {
    // show success message
    // refresh page
    alert(data.success);
    alert(data.bookingDate);

  } else {
    
    alert(data.error);
  }
});

}

</script>

{% endblock %}