{% extends 'index.html' %}
{% block content%}
<form id ="login-form" method="post">
    {% csrf_token %}
    <input type="text" name="username" placeholder="Username">
    <input type="password" name="password" placeholder="Password">
    
    <button  onclick="Click()" >Login</button>
    
    
</form>
{% if check %}
{% if messages %}
{% for message in messages %}
  <div>{{ message }}</div>
{% endfor %}
{% endif %}
{% endif %}
<script>
function Click() {
  var username = document.forms["login-form"]["username"].value;
  var password = document.forms["login-form"]["password"].value;
  var empty = true;

  if (username === "" ) {
    alert("Username field should not be left empty!");
    empty = false;
    return;
    
  }
  if (password === "") {
    alert("password field should not be left empty!");
    empty = false;
    return;
    
  }
 

  if (empty) {
    
    var formData = new FormData(document.getElementById('login-form'));
    var token = "{{ csrf_token }}";

    fetch('login', {
      method: 'POST',
      headers: {
        'X-CSRFToken': token
      },
      body: formData
    })
    .then(response => {
      if (response.redirected) {
       
        
        // 
      } else if (response.status === 403) {
        alert('403 Forbidden: incorrect CSRF token. Page will be refreshed.');
        
        window.location.href = response.url;
      } else {
        alert('An error occurred while processing your request.');
      }
    });
    
  }
  
}
</script>

{% endblock %}
